{% extends 'base.html' %}

{% load static %}

{% load crispy_forms_tags %}

{% load widget_tweaks %}

{% block titulo %}
{% endblock %}

{% block content %}
<div class="container mt-5 pt-5">
<h3 class="fs-2 fw-semibold">Cadastro</h3>
<hr>
<div class="" id="form-div" hx-target="#resultado-div">
    <form class="card p-3 mt-5" autocomplete="off" action="" method="POST">
        {% csrf_token %}
        <div class="row">
            <div class="col-2">{{ form.codigo|as_crispy_field }}</div>
            <div class="col-8">{{ form.descricao|as_crispy_field }}</div>
            <div class="col-2">{{ form.preco|as_crispy_field }}</div>
        </div>
        <div class="row">
            <div class="col-4" id="idacabamentoperfil" name="acabamento" value="{{acabamento.id}}">{{ form.acabamento|as_crispy_field }}</div>
            <div class="col-4">{{ form.tipo|as_crispy_field }}</div>
            <div class="col-4">{{ form.modelo|as_crispy_field }}</div>
        </div>
        <div class="row">
            <div class="col-4" type="radio" name="encaixe" id="idpermiteperfilpuxador" >{{ form.encaixe|as_crispy_field }}</div>
            <div class="col-8" id="idperfilpuxador" name="perfilpuxador">{{ form.perfil_puxador|as_crispy_field }}</div>
        </div>
        <div class="row">
            <div class="col-4" type="radio" name="encaixepuxador" id="idpermitepuxador">{{ form.encaixepuxador|as_crispy_field }}</div>
        </div>
         <div class="row">
            <div class="" id="idpuxador" name="puxadorsobreposto">{{ form.puxadorsobreposto|as_crispy_field }}</div>
        </div>
        <button type="submit" class="mt-3 btn btn-outline-primary" style="width: 100px;">Cadastrar</button>
    </form>
</div>

<script>
$(document).ready(function() {
  $('input[name="encaixe"], input[name="encaixepuxador"]').on('change', function() {
    var valorSelecionado1 = $('input[name="encaixe"]:checked').val();
    var valorSelecionado2 = $('input[name="encaixepuxador"]:checked').val();

    // Controlar a primeira div
    if (valorSelecionado1 === '1') {
      $('#idperfilpuxador').show();
    } else {
      $('#idperfilpuxador').clear
      $('#idperfilpuxador').hide();
    }

    // Controlar a segunda div
    if (valorSelecionado2 === '1') {
      $('#idpuxador').show();
    } else {
      $('#idpuxador').find('input[type="checkbox"]').prop('checked', false);
      $('#idpuxador').hide();
    }
  });
});
</script>

<script>
  $(document).ready(function() {
    $('#id_acabamento').change(function() {
      var acabamento = $(this).val(); // Obtenha o valor selecionado do acabamento

      $.ajax({
        url: '{% url 'filtrar_acabamento' %}',
        type: 'GET',
        data: {
          acabamento: acabamento
        },
        success: function(response) {
          var resultadosSelect = $('#idperfilpuxador');
          resultadosSelect.empty(); // Limpe as opções atuais

          // Adicione as novas opções com base nos resultados filtrados
          $(response).each(function() {
            resultadosSelect.append($('<option>', {
              value: this.valor,  // Substitua 'valor' pelo valor desejado do option
              text: this.texto   // Substitua 'texto' pelo texto desejado do option
            }));
          });
        },
        error: function(xhr) {
          console.log(xhr.statusText);
        }
      });
    });
  });
</script>

{% endblock %}